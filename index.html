<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title data-i18n="appTitle">গ্লোরি কুইজ স্যুট</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <style>
    :root {--bg:#050816;--grad:radial-gradient(circle at 20% 0%,rgba(99,102,241,.35),transparent 55%),radial-gradient(circle at 85% 20%,rgba(56,189,248,.3),transparent 60%),radial-gradient(circle at 5% 95%,rgba(34,197,94,.28),transparent 65%),#050816;--panel:rgba(10,15,30,.9);--panel-strong:rgba(6,12,24,.94);--glass-border:rgba(99,102,241,.28);--text:#f8fafc;--muted:#a5b4fc;--sub:#94a3b8;--accent:#6366f1;--accent2:#38bdf8;--accent3:#22c55e;--accent4:#f97316;}*{box-sizing:border-box;margin:0;padding:0;}body{font-family:'Poppins','Inter','Hind Siliguri',sans-serif;background:var(--grad);color:var(--text);min-height:100vh;overflow-x:hidden;}button{border:none;background:none;cursor:pointer;}::selection{background:rgba(99,102,241,.35);}a{color:inherit}
    .shell{max-width:1280px;margin:0 auto;padding:2.4rem 1.2rem 6rem;display:flex;flex-direction:column;gap:2rem;} .glass{background:var(--panel);border-radius:28px;border:1px solid var(--glass-border);box-shadow:0 32px 80px rgba(2,6,23,.62);backdrop-filter:blur(18px);-webkit-backdrop-filter:blur(18px);position:relative;overflow:hidden;} .glass::after{content:"";position:absolute;inset:0;border-radius:inherit;padding:1px;background:linear-gradient(135deg,rgba(99,102,241,.45),rgba(56,189,248,.35),rgba(34,197,94,.32));-webkit-mask:linear-gradient(#fff 0 0) content-box,linear-gradient(#fff 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none;} .floating-hub{position:fixed;top:22px;right:22px;display:flex;flex-direction:column;gap:0.8rem;z-index:40;} .floating-hub button{width:56px;height:56px;border-radius:18px;background:rgba(7,12,25,.92);border:1px solid rgba(129,140,248,.35);color:#e0e7ff;font-size:1.35rem;display:grid;place-items:center;transition:.25s;} .floating-hub button:hover{transform:translateY(-3px);box-shadow:0 14px 32px rgba(99,102,241,.35);} .floating-tip{position:absolute;right:70px;top:8px;padding:.7rem 1rem;border-radius:14px;background:rgba(7,12,25,.92);border:1px solid rgba(56,189,248,.35);color:#cbd5f5;font-size:.85rem;opacity:0;pointer-events:none;transform:translateY(6px);transition:.25s;width:190px;} .floating-hub button:hover+.floating-tip{opacity:1;transform:translateY(0);} @media(max-width:960px){.floating-hub{right:12px;top:18px;}.floating-hub button{width:50px;height:50px;font-size:1.2rem;}}
    .header{display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between;gap:1.2rem;padding:1.8rem 2.2rem;} .brand{display:flex;align-items:center;gap:1rem;} .brand-icon{width:64px;height:64px;border-radius:20px;background:rgba(99,102,241,.18);border:1px solid rgba(129,140,248,.4);display:grid;place-items:center;font-size:1.8rem;color:#c7d2fe;box-shadow:0 18px 42px rgba(99,102,241,.28);} .brand-title{font-size:clamp(2rem,3vw,2.7rem);font-weight:900;background:linear-gradient(120deg,#f472b6 0%,#818cf8 45%,#38bdf8 80%,#22c55e 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;} .status-chip{display:inline-flex;align-items:center;gap:.4rem;padding:.55rem 1.1rem;border-radius:999px;background:rgba(56,189,248,.16);border:1px solid rgba(56,189,248,.35);color:#bae6fd;font-weight:600;font-size:.82rem;letter-spacing:.04em;animation:pulse 3s ease-in-out infinite;}@keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.07);}}
    .lang-switch{display:flex;gap:.65rem;} .lang-btn{padding:.6rem 1.1rem;border-radius:999px;border:1px solid rgba(148,163,184,.28);color:#cbd5f5;font-weight:600;background:rgba(10,18,32,.78);transition:.25s;} .lang-btn.active,.lang-btn:hover{color:#fff;border-color:rgba(129,140,248,.6);box-shadow:0 16px 35px rgba(99,102,241,.32);} 
    .hero{padding:2.1rem 2rem;display:grid;gap:1.5rem;} .hero h2{font-size:clamp(2.2rem,3vw,3.2rem);font-weight:800;line-height:1.2;background:linear-gradient(120deg,#fff 0%,#c4b5fd 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;} .hero p{color:#c7d2fe;line-height:1.65;} .hero-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;} .hero-card{position:relative;padding:1.3rem;border-radius:20px;border:1px solid rgba(129,140,248,.22);background:rgba(8,15,30,.88);min-height:170px;display:flex;flex-direction:column;gap:.55rem;box-shadow:0 18px 38px rgba(3,7,18,.62);transition:.25s;} .hero-card::after{content:"";position:absolute;inset:0;background:radial-gradient(circle at top,rgba(129,140,248,.28),transparent 65%);opacity:0;transition:.25s;} .hero-card:hover{transform:translateY(-6px);border-color:rgba(56,189,248,.4);} .hero-card:hover::after{opacity:1;} .hero-card i{font-size:1.5rem;color:#c4b5fd;}
    .upload{padding:1.8rem;display:grid;gap:1.3rem;} .dock{display:flex;flex-wrap:wrap;align-items:center;gap:1rem;background:rgba(7,12,25,.92);border-radius:20px;border:1px solid rgba(129,140,248,.32);padding:1.2rem;} .icon-btn{width:56px;height:56px;border-radius:18px;border:1px solid rgba(56,189,248,.35);background:rgba(56,189,248,.18);color:#e0f2fe;font-size:1.3rem;display:grid;place-items:center;transition:.25s;} .icon-btn.camera{background:rgba(129,140,248,.2);border-color:rgba(129,140,248,.38);} .icon-btn.send{background:linear-gradient(120deg,#818cf8,#6366f1,#a855f7);color:#fff;box-shadow:0 20px 45px rgba(99,102,241,.45);} .icon-btn:disabled{opacity:.45;pointer-events:none;} .icon-btn:not(:disabled):hover{transform:translateY(-4px);box-shadow:0 18px 40px rgba(56,189,248,.3);} .hint{flex:1;min-width:240px;color:var(--muted);} .preview{display:flex;gap:.85rem;overflow-x:auto;padding-bottom:.5rem;} .preview-card{position:relative;width:100px;height:100px;border-radius:18px;border:1px solid rgba(129,140,248,.3);overflow:hidden;box-shadow:0 18px 38px rgba(5,8,22,.55);} .preview-card img{width:100%;height:100%;object-fit:cover;} .preview-card button{position:absolute;top:6px;right:6px;width:24px;height:24px;border-radius:50%;background:rgba(248,113,113,.9);color:#fff;font-size:.7rem;display:grid;place-items:center;}
    .modal{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;padding:1.4rem;background:rgba(3,6,14,.82);backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);opacity:0;pointer-events:none;transition:.3s;z-index:60;} .modal.visible{opacity:1;pointer-events:auto;} .card{width:min(520px,100%);background:var(--panel-strong);border-radius:24px;border:1px solid rgba(129,140,248,.32);box-shadow:0 32px 75px rgba(2,6,23,.72);padding:2rem;transform:translateY(18px) scale(.95);transition:.35s cubic-bezier(.34,1.56,.64,1);} .modal.visible .card{transform:translateY(0) scale(1);} .range-status{height:12px;border-radius:999px;background:linear-gradient(120deg,rgba(129,140,248,.45),rgba(56,189,248,.55));margin:1rem 0;}
    .processing-steps{display:grid;gap:.9rem;} .step{display:grid;grid-template-columns:auto 1fr;gap:.9rem;padding:1rem;border-radius:18px;background:rgba(9,14,28,.88);border:1px solid rgba(56,189,248,.25);align-items:center;} .step .badge{width:48px;height:48px;border-radius:16px;border:1px solid rgba(129,140,248,.32);display:grid;place-items:center;background:rgba(99,102,241,.18);font-size:1.2rem;color:#c7d2fe;animation:float 3s ease-in-out infinite;} .step.active{border-color:rgba(34,197,94,.5);box-shadow:0 18px 38px rgba(34,197,94,.28);} .step.done{border-color:rgba(56,189,248,.45);} @keyframes float{0%,100%{transform:translateY(0);}50%{transform:translateY(-6px);}}
    .quiz-card{width:min(960px,100%);} .quiz-grid{display:grid;gap:1.2rem;} .mentor-zone{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1.2rem;} .mentor-display{position:relative;border-radius:22px;border:1px solid rgba(129,140,248,.3);background:radial-gradient(circle at top,rgba(129,140,248,.25),rgba(8,14,26,.92));min-height:250px;display:flex;align-items:flex-end;justify-content:center;padding-bottom:1rem;} .mentor-body{position:relative;width:180px;aspect-ratio:3/4;background:linear-gradient(160deg,rgba(8,13,28,.95),rgba(15,23,42,.96));border-radius:24px 24px 70px 70px;border:1px solid rgba(148,163,184,.25);box-shadow:0 20px 40px rgba(5,9,26,.75);overflow:hidden;} .mentor-body::after{content:"";position:absolute;inset:0;background:linear-gradient(160deg,rgba(99,102,241,.32),rgba(14,165,233,.32));clip-path:polygon(18% 0,82% 0,100% 36%,80% 100%,20% 100%,0 36%);} .face{position:absolute;top:6%;left:50%;transform:translateX(-50%);width:64%;height:34%;background:radial-gradient(circle,#f1f5f9 0%,#cbd5f5 100%);border-radius:50% 50% 45% 45%;box-shadow:inset 0 -6px 12px rgba(8,13,24,.35);} .eyes{position:absolute;top:42%;left:50%;transform:translateX(-50%);display:flex;gap:18px;} .eyes span{width:16px;height:16px;border-radius:50%;background:radial-gradient(circle,#111827 30%,#0f172a 100%);box-shadow:0 0 0 6px rgba(255,255,255,.18);animation:blink 4.6s ease-in-out infinite;} @keyframes blink{0%,6%,12%,100%{transform:scaleY(1);}8%,10%{transform:scaleY(.1);}} .smile{position:absolute;top:58%;left:50%;transform:translateX(-50%);width:42px;height:16px;border-radius:0 0 20px 20px;border-bottom:4px solid rgba(14,165,233,.6);} .hat{position:absolute;top:-4%;left:50%;transform:translateX(-50%);width:70%;height:18%;background:linear-gradient(180deg,rgba(14,165,233,.9),rgba(14,116,233,.82));border-radius:70% 70% 0 0;box-shadow:0 14px 25px rgba(14,116,233,.4);} .stick{position:absolute;bottom:-6px;left:24%;width:10px;height:168px;border-radius:999px;background:linear-gradient(180deg,rgba(217,119,6,.9),rgba(245,158,11,.88));box-shadow:0 0 16px rgba(217,119,6,.4);transform-origin:bottom;animation:pointer 3.8s ease-in-out infinite;} @keyframes pointer{0%,100%{transform:rotate(2deg);}30%{transform:rotate(-4deg);}60%{transform:rotate(3deg);}}
    .target{position:absolute;top:28%;right:-36px;width:132px;height:132px;border-radius:50%;border:1px dashed rgba(56,189,248,.35);display:grid;place-items:center;font-size:.78rem;letter-spacing:.18em;text-transform:uppercase;color:rgba(56,189,248,.8);animation:target 4s ease-in-out infinite;} @keyframes target{0%,100%{transform:scale(1);opacity:.8;}50%{transform:scale(1.08);opacity:1;}}
    .scoreboard{border-radius:20px;border:1px solid rgba(129,140,248,.32);background:rgba(8,15,30,.88);padding:1.4rem;display:grid;gap:1rem;} .scorebox{display:flex;align-items:center;justify-content:space-between;gap:1rem;border-radius:16px;border:1px solid rgba(99,102,241,.25);background:rgba(10,16,29,.88);padding:1rem 1.2rem;} .progress{height:14px;border-radius:999px;background:rgba(148,163,184,.18);overflow:hidden;position:relative;} .progress span{position:absolute;inset:0;border-radius:inherit;background:linear-gradient(120deg,rgba(129,140,248,.85),rgba(56,189,248,.95));box-shadow:0 14px 30px rgba(56,189,248,.35);transform-origin:left;transform:scaleX(0);transition:.4s;} .question-panel{border-radius:22px;border:1px solid rgba(129,140,248,.32);background:rgba(9,14,28,.92);padding:1.6rem;display:grid;gap:1.1rem;position:relative;overflow:hidden;} .question-panel::before{content:"";position:absolute;inset:0;background:radial-gradient(circle at top left,rgba(129,140,248,.25),transparent 70%);pointer-events:none;} .question-number{display:flex;align-items:center;justify-content:space-between;gap:1rem;color:#cbd5f5;font-size:.9rem;letter-spacing:.08em;text-transform:uppercase;} .question-text{font-size:1.35rem;font-weight:600;line-height:1.6;color:#e0e7ff;text-shadow:0 4px 22px rgba(79,70,229,.35);} .options{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.9rem;} .option{position:relative;display:flex;align-items:center;gap:.8rem;padding:1rem 1.2rem;border-radius:18px;border:1px solid rgba(148,163,184,.24);background:rgba(10,16,29,.88);color:#e2e8f0;font-weight:600;transition:.22s;overflow:hidden;} .option:hover{transform:translateY(-4px);border-color:rgba(56,189,248,.45);box-shadow:0 18px 36px rgba(56,189,248,.25);} .marker{width:34px;height:34px;border-radius:12px;border:1px solid rgba(56,189,248,.4);background:rgba(56,189,248,.18);display:grid;place-items:center;color:#bae6fd;font-size:.9rem;font-weight:700;} .option.correct{border-color:rgba(34,197,94,.6);background:linear-gradient(135deg,rgba(34,197,94,.25),rgba(16,185,129,.28));color:#d1fae5;box-shadow:0 22px 45px rgba(16,185,129,.25);animation:glow 1.2s ease forwards;} @keyframes glow{0%{box-shadow:0 0 0 rgba(34,197,94,.35);}60%{box-shadow:0 0 32px rgba(34,197,94,.6);}100%{box-shadow:0 0 12px rgba(34,197,94,.35);}} .option.wrong{border-color:rgba(239,68,68,.55);background:linear-gradient(135deg,rgba(239,68,68,.22),rgba(248,113,113,.22));color:#fee2e2;box-shadow:0 20px 42px rgba(248,113,113,.25);animation:shake .6s cubic-bezier(.36,.07,.19,.97);} @keyframes shake{0%,100%{transform:translateX(0);}20%,60%{transform:translateX(-10px);}40%,80%{transform:translateX(10px);}}
    .feedback{position:absolute;left:1.2rem;right:1.2rem;bottom:1.2rem;border-radius:16px;border:1px solid rgba(129,140,248,.3);background:rgba(6,12,24,.9);padding:1rem 1.2rem;display:none;align-items:center;justify-content:space-between;gap:1rem;animation:slide .32s ease;} @keyframes slide{from{transform:translateY(14px);opacity:0;}to{transform:translateY(0);opacity:1;}} .points-float{position:absolute;font-weight:700;color:#34d399;font-size:1rem;animation:floatPoints .8s ease forwards;} @keyframes floatPoints{0%{opacity:0;transform:translateY(0);}30%{opacity:1;}100%{opacity:0;transform:translateY(-40px);}}
    .result-card{max-width:560px;text-align:center;position:relative;overflow:hidden;} .confetti{position:absolute;inset:0;background-image:radial-gradient(circle,rgba(129,140,248,.28) 20%,transparent 20%),radial-gradient(circle,rgba(56,189,248,.22) 20%,transparent 20%),radial-gradient(circle,rgba(34,197,94,.22) 20%,transparent 20%);background-size:160px 160px,140px 140px,180px 180px;opacity:0;pointer-events:none;} .result-card.show-confetti .confetti{animation:confetti 1.8s ease forwards;} @keyframes confetti{0%{opacity:0;transform:scale(.92);}40%{opacity:1;transform:scale(1.05);}100%{opacity:0;transform:scale(1.15);}}
    .toast{position:fixed;bottom:32px;right:32px;background:rgba(7,12,25,.92);border:1px solid rgba(34,197,94,.45);padding:.8rem 1.1rem;border-radius:16px;display:none;align-items:center;gap:.7rem;box-shadow:0 20px 42px rgba(2,6,23,.6);z-index:70;} .toast.visible{display:inline-flex;animation:toast .32s ease;} @keyframes toast{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:translateY(0);}}
    @media(max-width:860px){.shell{padding:2rem 1rem 5rem;}.header{padding:1.6rem;gap:1.4rem;flex-direction:column;align-items:flex-start;}.hero{padding:1.6rem;}.upload{padding:1.6rem;}.icon-btn{width:52px;height:52px;font-size:1.15rem;}.question-text{font-size:1.2rem;}}
  </style>
</head>
<body>
  <div class="floating-hub">
    <button id="api-btn" title="API"><i class="fas fa-key"></i></button>
    <div class="floating-tip" data-i18n="apiHint">আপনার কাস্টম API Key সেট করুন</div>
    <button id="history-btn" title="History"><i class="fas fa-history"></i></button>
    <div class="floating-tip" data-i18n="historyHint">কুইজ পারফরম্যান্স হিস্টোরি</div>
  </div>
  <main class="shell">
    <section class="glass header">
      <div class="brand">
        <div class="brand-icon"><i class="fas fa-bolt"></i></div>
        <div>
          <h1 class="brand-title" data-i18n="brandTitle">গ্লোরি • স্মার্ট প্রস্তুতি</h1>
          <p class="text-slate-300" data-i18n="brandSubtitle">লো কোয়ালিটি টেক্সট থেকেও প্রিমিয়াম কুইজ প্রস্তুতি</p>
        </div>
      </div>
      <div class="flex flex-wrap gap-3">
        <span class="status-chip" data-i18n="statusRealtime"><i class="fas fa-sparkles"></i>রিয়েলটাইম এআই</span>
        <span class="status-chip" data-i18n="statusTeacher"><i class="fas fa-chalkboard-teacher"></i>ভার্চুয়াল শিক্ষক</span>
      </div>
      <div class="lang-switch">
        <button class="lang-btn active" data-lang="bn">বাংলা</button>
        <button class="lang-btn" data-lang="en">English</button>
        <button class="lang-btn" data-lang="hi">हिन्दी</button>
      </div>
    </section>
    <section class="glass hero" id="hero">
      <div>
        <h2 data-i18n="heroHeading">আপনার অধ্যয়ন পেজকে রূপ দিন গেমিফাইড কুইজে</h2>
        <p data-i18n="heroSubheading">গ্লোরি AI নিম্নমানের ছবিকেও বিশ্লেষণ করে গুরুত্বপূর্ণ তথ্য বের করে আনে, এনিমেটেড শিক্ষক ও পয়েন্ট সিস্টেমসহ অনুপ্রেরণাদায়ক কুইজ অভিজ্ঞতা তৈরি করে।</p>
      </div>
      <div class="hero-grid">
        <article class="hero-card">
          <i class="fas fa-camera-rotate"></i>
          <h3 data-i18n="cardCaptureTitle">ক্যাপচার • আপলোড</h3>
          <p data-i18n="cardCaptureDesc">গ্যালারি অথবা ক্যামেরা থেকে বইয়ের পেজ তুলে দিন, বাকি দায়িত্ব গ্লোরির।</p>
        </article>
        <article class="hero-card">
          <i class="fas fa-wand-magic-sparkles"></i>
          <h3 data-i18n="cardAnalysisTitle">মাল্টি-স্টেজ বিশ্লেষণ</h3>
          <p data-i18n="cardAnalysisDesc">OCR → সারাংশ → কুইজ। প্রতিটি ধাপেই আপনি আপডেট পাবেন।</p>
        </article>
        <article class="hero-card">
          <i class="fas fa-gamepad"></i>
          <h3 data-i18n="cardPlayTitle">গেমিফাইড মেন্টর</h3>
          <p data-i18n="cardPlayDesc">শিক্ষক চরিত্রের ইঙ্গিত, শব্দ ও আলোতে প্রতিটি উত্তরে জীবন্ত ফিডব্যাক।</p>
        </article>
        <article class="hero-card">
          <i class="fas fa-chart-line"></i>
          <h3 data-i18n="cardProgressTitle">লাইভ স্কোরবোর্ড</h3>
          <p data-i18n="cardProgressDesc">পয়েন্ট কাউন্টার, ইতিহাস লগ ও অনুপ্রেরণামূলক বার্তা একসাথে।</p>
        </article>
      </div>
    </section>
    <section class="glass upload">
      <div class="dock">
        <div class="flex items-center gap-3">
          <button class="icon-btn" id="gallery-btn" data-i18n-title="galleryBtn" title="Gallery"><i class="fas fa-image"></i></button>
          <input type="file" id="gallery-input" accept="image/*" multiple class="hidden" />
          <button class="icon-btn camera" id="camera-btn" data-i18n-title="cameraBtn" title="Camera"><i class="fas fa-camera"></i></button>
          <input type="file" id="camera-input" accept="image/*" capture="environment" class="hidden" />
        </div>
        <p class="hint" data-i18n="uploadHint">অধ্যায়ন পেজ নির্বাচন করুন, তারপর পাঠানোর আইকনে ট্যাপ করুন।</p>
        <button class="icon-btn send" id="send-btn"><i class="fas fa-paper-plane"></i></button>
      </div>
      <div class="preview" id="preview"></div>
      <p id="error-text" class="text-rose-400 font-semibold hidden"></p>
    </section>
  </main>
  <div class="modal" id="question-modal">
    <div class="card">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-bold" data-i18n="questionModalTitle">কতগুলো প্রশ্ন তৈরি করতে চান?</h3>
        <button id="question-close" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
      </div>
      <p class="text-slate-300 mb-3" data-i18n="questionModalDesc">সর্বোচ্চ ৬০টি প্রশ্ন। সংখ্যা যত বেশি, অনুশীলন তত গভীর।</p>
      <div class="range-status"></div>
      <div class="flex items-center gap-4 mb-6">
        <input type="range" min="3" max="60" value="10" id="question-range" class="w-full accent-indigo-400" />
        <span class="text-3xl font-black text-indigo-200" id="question-value">10</span>
      </div>
      <div class="grid gap-3">
        <button class="px-5 py-3 rounded-full text-white font-semibold shimmer-button" id="question-continue" data-i18n="questionContinue">চালিয়ে যান</button>
        <button class="px-4 py-2 rounded-full border border-slate-600 text-slate-300 hover:border-indigo-400" id="quick-five" data-i18n="questionQuickFive">দ্রুত ৫ প্রশ্ন</button>
      </div>
    </div>
  </div>
  <div class="modal" id="processing-modal">
    <div class="card" id="processing-card">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-bold" data-i18n="processingTitle">এআই বিশ্লেষণ চলছে...</h3>
        <span class="text-sm text-slate-400" id="processing-status" data-i18n="processingStatus">স্টেপ ১ / ৩</span>
      </div>
      <div class="processing-steps" id="processing-steps"></div>
      <p class="text-sm text-slate-300 mt-5" data-i18n="processingFooter">গুরুত্বপূর্ণ তথ্য খুঁজে বের করা হচ্ছে ও কুইজে রূপান্তর করা হচ্ছে। দয়া করে ট্যাব বন্ধ করবেন না।</p>
    </div>
  </div>
  <div class="modal" id="quiz-modal">
    <div class="card quiz-card">
      <div class="flex items-center justify-between mb-5">
        <div>
          <h3 class="text-xl font-bold" data-i18n="quizTitle">গ্লোরি কুইজ অ্যারেনা</h3>
          <p class="text-sm text-slate-400" id="quiz-progress">0 / 0</p>
        </div>
        <span class="status-chip uppercase" data-i18n="quizChip">তোমাকে পারতেই হবে</span>
      </div>
      <div class="quiz-grid">
        <div class="mentor-zone">
          <div class="mentor-display">
            <div class="mentor-body">
              <div class="face"></div>
              <div class="eyes"><span></span><span></span></div>
              <div class="smile"></div>
              <div class="hat"></div>
            </div>
            <div class="stick"></div>
            <div class="target" data-i18n="pointerLabel">ফোকাস জোন</div>
          </div>
          <div class="scoreboard">
            <div class="scorebox">
              <div>
                <p class="text-xs text-slate-400 uppercase tracking-[0.2em]" data-i18n="scoreTotal">মোট পয়েন্ট</p>
                <h4 class="text-3xl font-black" id="score-points">0000</h4>
              </div>
              <div class="text-right">
                <p class="text-xs text-slate-400 uppercase tracking-[0.2em]" data-i18n="scoreQuestions">উত্তর</p>
                <h4 class="text-lg font-semibold text-indigo-200" id="score-answered">0</h4>
              </div>
            </div>
            <div>
              <p class="text-xs text-slate-400 uppercase tracking-[0.2em] mb-2" data-i18n="scoreProgress">অগ্রগতি</p>
              <div class="progress"><span id="progress-bar"></span></div>
            </div>
          </div>
        </div>
        <div class="question-panel">
          <div class="question-number"><span id="question-label">Q1</span><span id="question-topic" class="text-indigo-200">GLORY</span></div>
          <div class="question-text" id="question-text">---</div>
          <div class="options" id="options"></div>
          <div class="feedback" id="feedback">
            <div>
              <p class="font-semibold" id="feedback-main">...</p>
              <p class="text-sm text-slate-300" id="feedback-sub">...</p>
            </div>
            <button class="px-5 py-2 rounded-full shimmer-button text-sm font-semibold" id="next-question" data-i18n="feedbackNext">পরবর্তী প্রশ্ন</button>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="modal" id="result-modal">
    <div class="card result-card" id="result-card">
      <div class="confetti"></div>
      <h3 class="status-chip mb-4" id="result-title">অভিনন্দন!</h3>
      <div class="text-5xl font-black text-emerald-300 mb-2" id="result-score">0%</div>
      <p class="text-slate-200 mb-5" id="result-message">---</p>
      <div class="grid gap-3 max-w-sm mx-auto">
        <button class="px-5 py-3 rounded-full shimmer-button text-white font-semibold" id="result-retry" data-i18n="resultReplay">আবার অনুশীলন করুন</button>
        <button class="px-5 py-2 rounded-full border border-slate-600 text-slate-300 hover:border-indigo-400" id="result-home" data-i18n="resultClose">হোমে ফিরে যান</button>
      </div>
    </div>
  </div>
  <div class="modal" id="api-modal">
    <div class="card">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-bold" data-i18n="apiTitle">API Key সেটআপ</h3>
        <button id="api-close" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
      </div>
      <p class="text-sm text-slate-300 mb-4" data-i18n="apiDescription">গুগল AI স্টুডিও থেকে প্রাপ্ত কী যুক্ত করলে নিজের কোটায় কুইজ তৈরি করতে পারবেন। খালি রাখলে ডিফল্ট কী ব্যবহৃত হবে।</p>
      <label class="text-sm font-semibold text-slate-300 mb-2 block" data-i18n="apiLabel">Google AI Studio Key</label>
      <input id="api-input" class="w-full api-input mb-4" placeholder="AIzaSy..." data-i18n-placeholder="apiPlaceholder" />
      <div class="grid grid-cols-2 gap-3">
        <button class="px-4 py-2 rounded-full shimmer-button text-white font-semibold" id="api-save" data-i18n="apiSave">সংরক্ষণ</button>
        <button class="px-4 py-2 rounded-full border border-slate-600 text-slate-300 hover:border-rose-400" id="api-clear" data-i18n="apiClear">মুছুন</button>
      </div>
    </div>
  </div>
  <div class="modal" id="history-modal">
    <div class="card" style="max-width:620px;">
      <div class="flex items-center justify-between mb-4">
        <h3 class="text-2xl font-bold" data-i18n="historyTitle">কুইজ হিস্টোরি</h3>
        <button id="history-close" class="text-slate-400 hover:text-white"><i class="fas fa-times"></i></button>
      </div>
      <div class="grid gap-3" id="history-list"></div>
      <button class="mt-4 px-4 py-2 rounded-full border border-rose-500 text-rose-300 hover:bg-rose-500 hover:text-white text-sm" id="history-clear" data-i18n="historyClear">সমস্ত হিস্টোরি মুছুন</button>
    </div>
  </div>
  <div class="toast" id="toast"><i class="fas fa-circle-check text-emerald-400"></i><span id="toast-text">Saved</span></div>
  <script src="https://lib.youware.com/youware-ai-4.3.16.js"></script>
  <script src="https://lib.youware.com/youware-openai-1.3.22.js"></script>
  <script src="https://lib.youware.com/youware-zod-3.25.67.js"></script>
  <script type="module">
    const $ = (s) => document.querySelector(s);
    const $$ = (s) => document.querySelectorAll(s);
    const state = {lang: localStorage.getItem('gloryLang') || 'bn', files: [], previews: [], base64: [], mime: [], quiz: [], index: 0, score: 0, points: 0, answered: 0, questionCount: 10, history: JSON.parse(localStorage.getItem('gloryHistory') || '[]'), customKey: localStorage.getItem('gloryGeminiKey') || '', processingStepIndex: 0, feedbackWaiting: false};
    const DEFAULT_KEY = 'AIzaSyBUd0XZUgyHUMU40IoTqf_RY7JaSXANLBo';
    const translations = {
      bn: {appTitle:'গ্লোরি কুইজ স্যুট', brandTitle:'গ্লোরি • স্মার্ট প্রস্তুতি', brandSubtitle:'লো কোয়ালিটি টেক্সট থেকেও প্রিমিয়াম কুইজ প্রস্তুতি', statusRealtime:'রিয়েলটাইম এআই', statusTeacher:'ভার্চুয়াল শিক্ষক', heroHeading:'আপনার অধ্যয়ন পেজকে রূপ দিন গেমিফাইড কুইজে', heroSubheading:'গ্লোরি AI নিম্নমানের ছবিকেও বিশ্লেষণ করে গুরুত্বপূর্ণ তথ্য বের করে আনে, এনিমেটেড শিক্ষক ও পয়েন্ট সিস্টেমসহ অনুপ্রেরণাদায়ক কুইজ অভিজ্ঞতা তৈরি করে।', cardCaptureTitle:'ক্যাপচার • আপলোড', cardCaptureDesc:'গ্যালারি অথবা ক্যামেরা থেকে বইয়ের পেজ তুলে দিন, বাকি দায়িত্ব গ্লোরির।', cardAnalysisTitle:'মাল্টি-স্টেজ বিশ্লেষণ', cardAnalysisDesc:'OCR → সারাংশ → কুইজ। প্রতিটি ধাপেই আপনি আপডেট পাবেন।', cardPlayTitle:'গেমিফাইড মেন্টর', cardPlayDesc:'শিক্ষক চরিত্রের ইঙ্গিত, শব্দ ও আলোতে প্রতিটি উত্তরে জীবন্ত ফিডব্যাক।', cardProgressTitle:'লাইভ স্কোরবোর্ড', cardProgressDesc:'পয়েন্ট কাউন্টার, ইতিহাস লগ ও অনুপ্রেরণামূলক বার্তা একসাথে।', uploadHint:'অধ্যায়ন পেজ নির্বাচন করুন, তারপর পাঠানোর আইকনে ট্যাপ করুন।', apiHint:'আপনার কাস্টম API Key সেট করুন', historyHint:'কুইজ পারফরম্যান্স হিস্টোরি', questionModalTitle:'কতগুলো প্রশ্ন তৈরি করতে চান?', questionModalDesc:'সর্বোচ্চ ৬০টি প্রশ্ন। সংখ্যা যত বেশি, অনুশীলন তত গভীর।', questionContinue:'চালিয়ে যান', questionQuickFive:'দ্রুত ৫ প্রশ্ন', processingTitle:'এআই বিশ্লেষণ চলছে...', processingStatus:'স্টেপ ১ / ৩', processingFooter:'গুরুত্বপূর্ণ তথ্য খুঁজে বের করা হচ্ছে ও কুইজে রূপান্তর করা হচ্ছে। দয়া করে ট্যাব বন্ধ করবেন না।', processingSteps:['লো-কোয়ালিটি ছবি স্পষ্ট করা ও টেক্সট সংগ্রহ','মূল সূত্র শনাক্ত করা','নির্ধারিত সংখ্যক কুইজ নির্মাণ'], quizTitle:'গ্লোরি কুইজ অ্যারেনা', quizChip:'তোমাকে পারতেই হবে', pointerLabel:'ফোকাস জোন', scoreTotal:'মোট পয়েন্ট', scoreQuestions:'উত্তর', scoreProgress:'অগ্রগতি', feedbackNext:'পরবর্তী প্রশ্ন', resultReplay:'আবার অনুশীলন করুন', resultClose:'হোমে ফিরে যান', apiTitle:'API Key সেটআপ', apiDescription:'গুগল AI স্টুডিও থেকে প্রাপ্ত কী যুক্ত করলে নিজের কোটায় কুইজ তৈরি করতে পারবেন। খালি রাখলে ডিফল্ট কী ব্যবহৃত হবে।', apiLabel:'Google AI Studio Key', apiPlaceholder:'AIzaSy...', apiSave:'সংরক্ষণ', apiClear:'মুছুন', historyTitle:'কুইজ হিস্টোরি', historyClear:'সমস্ত হিস্টোরি মুছুন', galleryBtn:'গ্যালারি থেকে ছবি', cameraBtn:'ক্যামেরা থেকে ছবি', toastSaved:'সাফল্যের সাথে সংরক্ষিত', toastCleared:'ডেটা মুছে ফেলা হয়েছে', toastError:'কিছু ভুল হয়েছে', questionsLabel:'প্রশ্ন', scoreLabel:'স্কোর', justNow:'এইমাত্র', minutesAgo:'মিনিট আগে', hoursAgo:'ঘণ্টা আগে', daysAgo:'দিন আগে', emptyHistory:'কোনো হিস্টোরি নেই। আজই গ্লোরি কুইজ শুরু করুন।', encouragementWrong:['তোমাকে পারতেই হবে! আবার চেষ্টা করো।','ভুল হলেও শেখার নতুন রাস্তা খুলল।','মনোযোগ বাড়াও, সফলতা সামনে।'], encouragementRight:['গৌরবময়! তোমার উত্তরে জ্বলজ্বল করছে বুদ্ধি।','দারুণ! এই ধারাবাহিকতা ধরে রাখো।','মেন্টর তোমার অগ্রগতিতে খুশি।'], subWrong:['নির্ভয়ে আবার দেখো, শিক্ষক তোমার পাশে।','ইঙ্গিতগুলো পড়ে একবার পুনরায় ভাবো।','চিন্তা নেই, অনুশীলনেই দক্ষতা।'], subRight:['পয়েন্ট কাউন্টার ঝলমল করছে।','এই গতি বজায় রাখো।','আরো এক ধাপ এগিয়ে গেলে।'], resultPerfect:'মেগা গ্লোরিয়াস!', resultGreat:'গৌরবময় সফলতা!', resultGood:'অসাধারণ অগ্রগতি!', resultTry:'চেষ্টা অব্যাহত রাখো!', resultPerfectMsg:'সব প্রশ্নে নিখুঁত! এখন তুমি গ্লোরির মেন্টরদের সমপর্যায়ে।', resultGreatMsg:'দারুণ প্রস্তুতি—মাত্র কয়েক ধাপ দূরে পূর্ণতা।', resultGoodMsg:'খুবই ভালো! একটু অনুশীলনেই শীর্ষে উঠে যাবে।', resultTryMsg:'প্রতিটি ভুলই শক্তিশালী পাঠ। আজ নয় তো কাল তুমি পারবেই।', historyScore:'স্কোর', historyDate:'তারিখ', historyQuestions:'প্রশ্ন'},
      en: {appTitle:'Glory Quiz Suite', brandTitle:'Glory • Smart Preparation', brandSubtitle:'Premium quizzes even from low quality study photos', statusRealtime:'Realtime AI', statusTeacher:'Virtual Mentor', heroHeading:'Transform study pages into gamified quizzes', heroSubheading:'Glory AI reads low quality captures, extracts insights and builds an inspiring quiz with mentor-style feedback.', cardCaptureTitle:'Capture • Upload', cardCaptureDesc:'Pick textbook pages from gallery or camera—Glory handles the rest.', cardAnalysisTitle:'Multi-stage analysis', cardAnalysisDesc:'OCR → Synthesis → Quiz with live progress indicators.', cardPlayTitle:'Gamified mentor', cardPlayDesc:'Animated teacher, audio cues and glowing highlights elevate every attempt.', cardProgressTitle:'Live scoreboard', cardProgressDesc:'Points, history and motivational phrases in one panel.', uploadHint:'Choose study pages then tap send to begin.', apiHint:'Set your custom API key', historyHint:'Quiz performance history', questionModalTitle:'How many questions do you need?', questionModalDesc:'Up to 60 questions. Higher count unlocks deeper mastery.', questionContinue:'Continue', questionQuickFive:'Quick 5 Questions', processingTitle:'AI is working...', processingStatus:'Step 1 / 3', processingFooter:'Extracting insights and composing your quiz. Keep this tab open.', processingSteps:['Enhancing photo & reading text','Detecting core concepts','Composing your adaptive quiz'], quizTitle:'Glory Quiz Arena', quizChip:'You must conquer', pointerLabel:'Focus Zone', scoreTotal:'Total Points', scoreQuestions:'Answered', scoreProgress:'Progress', feedbackNext:'Next Question', resultReplay:'Practice Again', resultClose:'Return Home', apiTitle:'API Key Setup', apiDescription:'Use your Google AI Studio key to rely on personal quota. Leave empty for default.', apiLabel:'Google AI Studio Key', apiPlaceholder:'AIzaSy...', apiSave:'Save', apiClear:'Clear', historyTitle:'Quiz History', historyClear:'Clear history', galleryBtn:'Select from gallery', cameraBtn:'Open camera', toastSaved:'Saved successfully', toastCleared:'Data cleared', toastError:'Something went wrong', questionsLabel:'Questions', scoreLabel:'Score', justNow:'just now', minutesAgo:'minutes ago', hoursAgo:'hours ago', daysAgo:'days ago', emptyHistory:'No history yet. Start your Glory quiz today.', encouragementWrong:['You must conquer! Try again.','Mistakes build mastery.','Reset focus and strike back.'], encouragementRight:['Glorious insight!','Excellent response.','Mentor applauds your brilliance.'], subWrong:['Mentor will guide you again.','Check the clues and retry.','Review the concept carefully.'], subRight:['Point counter glows brighter.','Keep this momentum.','Another stride toward mastery.'], resultPerfect:'Mega Glorious!', resultGreat:'Triumphant!', resultGood:'Great Progress!', resultTry:'Keep pushing!', resultPerfectMsg:'You conquered every question flawlessly!', resultGreatMsg:'Phenomenal performance—just shy of perfection.', resultGoodMsg:'Solid progress! A bit more practice seals the deal.', resultTryMsg:'Every attempt teaches new tactics. Stay determined.', historyScore:'Score', historyDate:'Date', historyQuestions:'Questions'},
      hi: {appTitle:'ग्लोरी क्विज़ सूट', brandTitle:'Glory • स्मार्ट तैयारी', brandSubtitle:'कम गुणवत्ता वाली तस्वीरों से भी प्रीमियम क्विज़', statusRealtime:'रीयलटाइम एआई', statusTeacher:'वर्चुअल गुरु', heroHeading:'अपनी पढ़ाई को गेमिफाइड क्विज़ में बदलें', heroSubheading:'Glory AI धुंधली तस्वीरों से भी ज्ञान निकालकर गुरु शैली में क्विज़ तैयार करता है.', cardCaptureTitle:'कैप्चर • अपलोड', cardCaptureDesc:'गैलरी या कैमरा से पेज लें, बाकी काम Glory करेगा.', cardAnalysisTitle:'बहु-चरण विश्लेषण', cardAnalysisDesc:'OCR → सार → क्विज़ तैयार, चरण दर चरण अपडेट.', cardPlayTitle:'गेमिफाइड गुरु', cardPlayDesc:'एनीमेटेड शिक्षक, ध्वनि प्रभाव और चमकदार हाइलाइट हर उत्तर को यादगार बनाते हैं.', cardProgressTitle:'लाइव स्कोरबोर्ड', cardProgressDesc:'पॉइंट काउंटर, इतिहास और प्रेरणादायक संवाद एक साथ.', uploadHint:'पढ़ा गया पेज चुनें और भेजें आइकन दबाएँ.', apiHint:'अपना कस्टम API Key सेट करें', historyHint:'क्विज़ प्रदर्शन इतिहास', questionModalTitle:'कितने प्रश्न बनाए जाएँ?', questionModalDesc:'अधिकतम 60 प्रश्न। संख्या जितनी अधिक, तैयारी उतनी गहरी.', questionContinue:'जारी रखें', questionQuickFive:'जल्दी 5 प्रश्न', processingTitle:'एआई विश्लेषण कर रहा है...', processingStatus:'चरण 1 / 3', processingFooter:'महत्वपूर्ण जानकारी खोजी जा रही है। टैब बंद न करें.', processingSteps:['कम गुणवत्ता वाली छवि से स्पष्ट पाठ निकालना','मुख्य बिंदु समझना','अनुकूल क्विज़ तैयार करना'], quizTitle:'Glory क्विज़ एरीना', quizChip:'जीतना ही होगा', pointerLabel:'फोकस ज़ोन', scoreTotal:'कुल पॉइंट', scoreQuestions:'उत्तर', scoreProgress:'प्रगति', feedbackNext:'अगला प्रश्न', resultReplay:'फिर से अभ्यास करें', resultClose:'होम लौटें', apiTitle:'API Key सेटअप', apiDescription:'Google AI Studio Key जोड़ें या डिफॉल्ट पर থাকুন.', apiLabel:'Google AI Studio Key', apiPlaceholder:'AIzaSy...', apiSave:'सेव', apiClear:'हटाएँ', historyTitle:'क्विज़ इतिहास', historyClear:'इतिहास साफ़ करें', galleryBtn:'गैलरी से चुनें', cameraBtn:'कैमरा खोलें', toastSaved:'सफलतापूर्वक सहेजा गया', toastCleared:'डेटा हटाया गया', toastError:'कुछ त्रुटि हुई', questionsLabel:'प्रश्न', scoreLabel:'स्कोर', justNow:'अभी', minutesAgo:'मिनट पहले', hoursAgo:'घंटे पहले', daysAgo:'दिन पहले', emptyHistory:'अभी कोई इतिहास नहीं। आज ही Glory क्विज़ शुरू करें.', encouragementWrong:['तुम्हें जीतना ही होगा! फिर प्रयास करो.','गलतियां सफलता का रास्ता खोलती हैं.','ध्यान केंद्रित करो, गुरु साथ है.'], encouragementRight:['गौरवशाली उत्तर!','उत्कृष्ट विचार.','गुरु तुम्हारी तारीफ़ कर रहा है.'], subWrong:['गुरु फिर समझाएगा, हिम्मत रखो.','सुराग पढ़ो और फिर प्रयास करो.','अवधारणा दोबारा देखें.'], subRight:['पॉइंट काउंटर चमक उठा.','ये लय बनाए रखो.','महारत के करीब हो.'], resultPerfect:'मेगा ग्लोरियस!', resultGreat:'शानदार विजय!', resultGood:'उत्कृष्ट प्रगति!', resultTry:'हिम्मत मत हारो!', resultPerfectMsg:'तुमने हर प्रश्न को फतह किया!', resultGreatMsg:'असाधारण प्रदर्शन, लगभग पूर्णता.', resultGoodMsg:'मजबूत प्रगति! थोड़ा अभ्यास और.', resultTryMsg:'हर प्रयास सीख बनता है, डटे रहो.', historyScore:'स्कोर', historyDate:'तारीख', historyQuestions:'प्रश्न'} };
    function applyTranslations(){const t=translations[state.lang];document.title=t.appTitle;$$("[data-i18n]").forEach(el=>{const key=el.getAttribute('data-i18n');if(t[key]) el.textContent=t[key];});$$("[data-i18n-title]").forEach(el=>{const key=el.getAttribute('data-i18n-title');if(t[key]) el.title=t[key];});$$("[data-i18n-placeholder]").forEach(el=>{const key=el.getAttribute('data-i18n-placeholder');if(t[key]) el.placeholder=t[key];});$$('.lang-btn').forEach(btn=>{btn.classList.toggle('active',btn.dataset.lang===state.lang);});}
    function showModal(id, show){const modal=$(id);if(!modal) return;modal.classList.toggle('visible',show);} const questionModal="#question-modal"; const processingModal="#processing-modal"; const quizModal="#quiz-modal"; const resultModal="#result-modal"; const apiModal="#api-modal"; const historyModal="#history-modal";
    function toast(message, positive=true){const el=$('#toast');$('#toast-text').textContent=message;el.classList.toggle('visible',true);el.style.borderColor=positive?'rgba(34,197,94,.45)':'rgba(248,113,113,.5)';setTimeout(()=>el.classList.remove('visible'),2500);}
    function readFiles(fileList){const incoming=[...fileList].filter(f=>f.type.startsWith('image/'));const existing=new Set(state.files.map(f=>`${f.name}-${f.size}`));incoming.forEach(f=>{const key=`${f.name}-${f.size}`;if(!existing.has(key)) state.files.push(f);});renderPreviews();}
    function renderPreviews(){const container=$('#preview');container.innerHTML='';state.base64=[];state.mime=[];if(!state.files.length){$('#send-btn').disabled=true;return;}$('#send-btn').disabled=false;state.files.forEach((file,idx)=>{const card=document.createElement('div');card.className='preview-card';const img=document.createElement('img');img.src=URL.createObjectURL(file);card.appendChild(img);const remove=document.createElement('button');remove.innerHTML='<i class="fas fa-times"></i>';remove.onclick=()=>{state.files.splice(idx,1);URL.revokeObjectURL(img.src);renderPreviews();};card.appendChild(remove);container.appendChild(card);const reader=new FileReader();reader.onload=()=>{const base=reader.result.split(',')[1];state.base64[idx]=base;state.mime[idx]=file.type||'image/jpeg';};reader.readAsDataURL(file);});}
    function formatRelative(date){const t=translations[state.lang];const diff=(Date.now()-date)/1000;if(diff<60) return t.justNow;if(diff<3600) return `${Math.round(diff/60)} ${t.minutesAgo}`;if(diff<86400) return `${Math.round(diff/3600)} ${t.hoursAgo}`;return `${Math.round(diff/86400)} ${t.daysAgo}`;}
    function updateHistory(){const list=$('#history-list');const t=translations[state.lang];if(!state.history.length){list.innerHTML=`<div class="text-slate-400 text-center py-6">${t.emptyHistory}</div>`;return;}list.innerHTML=state.history.map(item=>`<div class="glass p-4 rounded-2xl border border-slate-600/40 bg-slate-900/70"> <div class="flex justify-between items-center mb-2"><span class="font-semibold">${item.percentage}%</span><span class="text-xs text-slate-400">${formatRelative(item.date)}</span></div><div class="text-sm text-slate-300">${t.questionsLabel}: ${item.total} • ${t.scoreLabel}: ${item.score}</div></div>`).join('');}
    function saveHistory(entry){state.history.unshift(entry);state.history=state.history.slice(0,40);localStorage.setItem('gloryHistory',JSON.stringify(state.history));}
    function resetQuizState(){state.quiz=[];state.index=0;state.score=0;state.points=0;state.answered=0;state.feedbackWaiting=false;$('#score-points').textContent='0000';$('#score-answered').textContent='0';$('#progress-bar').style.transform='scaleX(0)';$('#question-text').textContent='---';$('#options').innerHTML='';$('#feedback').style.display='none';$('#quiz-progress').textContent='0 / 0';}
    function updateProcessingSteps(){const stepsContainer=$('#processing-steps');const steps=translations[state.lang].processingSteps;stepsContainer.innerHTML='';steps.forEach((step,idx)=>{const div=document.createElement('div');div.className='step';div.innerHTML=`<div class="badge">${idx+1}</div><div><p class="font-semibold">${step}</p><p class="text-slate-400 text-sm" id="step-note-${idx}"></p></div>`;stepsContainer.appendChild(div);});}
    function setStepStatus(current,total){const status=$('#processing-status');status.textContent=`${translations[state.lang].processingStatus.split('স্টেপ')[0]||'Step'} ${current} / ${total}`;$('#processing-steps').querySelectorAll('.step').forEach((step,idx)=>{step.classList.remove('active','done');if(idx<current-1) step.classList.add('done');else if(idx===current-1) step.classList.add('active');});}
    function speak(text){try{const utter=new SpeechSynthesisUtterance(text);utter.lang=state.lang==='bn'?'bn-BD':state.lang==='hi'?'hi-IN':'en-US';utter.pitch=1;utter.rate=1;window.speechSynthesis.cancel();window.speechSynthesis.speak(utter);}catch(e){console.warn('speech error',e);}}
    function correctTone(){if(!window.AudioContext) return;state.audioCtx=state.audioCtx||new AudioContext();const ctx=state.audioCtx;const osc=ctx.createOscillator();const gain=ctx.createGain();osc.connect(gain);gain.connect(ctx.destination);osc.type='sine';osc.frequency.setValueAtTime(440,ctx.currentTime);osc.frequency.linearRampToValueAtTime(659.25,ctx.currentTime+.2);gain.gain.setValueAtTime(0,ctx.currentTime);gain.gain.linearRampToValueAtTime(.5,ctx.currentTime+.02);gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.4);osc.start();osc.stop(ctx.currentTime+.4);} function wrongTone(){if(!window.AudioContext) return;state.audioCtx=state.audioCtx||new AudioContext();const ctx=state.audioCtx;const osc=ctx.createOscillator();const gain=ctx.createGain();osc.connect(gain);gain.connect(ctx.destination);osc.type='square';osc.frequency.setValueAtTime(180,ctx.currentTime);gain.gain.setValueAtTime(.4,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(.001,ctx.currentTime+.25);osc.start();osc.stop(ctx.currentTime+.25);} document.body.addEventListener('click',()=>{try{state.audioCtx?.resume();}catch{}} ,{once:true});
    async function generateQuiz(){const apiKey=state.customKey||DEFAULT_KEY;const endpoint=`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;const langLabel=state.lang==='en'?'English':state.lang==='hi'?'Hindi':'Bengali';const parts=[{text:`You are an elite ${langLabel} teacher. Carefully read every provided textbook photo even if it is noisy, blurred, tilted or low-light. Step 1: enhance and OCR each image and return the clean text internally. Step 2: synthesise the core concepts, formulas and definitions that a student must know. Step 3: create ${state.questionCount} MCQ questions in ${langLabel}. Each question must have exactly four options. Provide the data strictly as valid JSON with the shape {"summary":"...","key_points":["..."],"questions":[{"question":"...","options":["...","...","...","..."],"answer":"...","explanation":"..."}]}. The answer field must exactly match one option string.`},...state.base64.map((data,i)=>({inlineData:{mimeType:state.mime[i]||'image/jpeg',data}}))];const payload={contents:[{parts}]};console.log('🤖 Gemini Request:',{questions:state.questionCount,language:state.lang,images:state.base64.length});const res=await fetch(endpoint,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});if(!res.ok){throw new Error(`API Error - Gemini status ${res.status}`);}const json=await res.json();const text=json.candidates?.[0]?.content?.parts?.[0]?.text;if(!text) throw new Error('API Error - Empty model response');const cleaned=text.replace(/```json|```/g,'').trim();let parsed;try{parsed=JSON.parse(cleaned);}catch(err){console.error('❌ JSON parse error',err,cleaned);throw new Error('API Error - Invalid JSON payload');}console.log('✅ Gemini Response:',{questions:parsed.questions?.length});return parsed;}
    function renderQuestion(){const current=state.quiz[state.index];if(!current){showResults();return;}$('#quiz-progress').textContent=`${state.index+1} / ${state.quiz.length}`;$('#question-label').textContent=`Q${state.index+1}`;$('#question-text').textContent=current.question;$('#options').innerHTML='';const letters=['A','B','C','D'];current.options.forEach((opt,idx)=>{const btn=document.createElement('button');btn.className='option';btn.innerHTML=`<span class="marker">${letters[idx]}</span><span>${opt}</span>`;btn.onclick=()=>selectOption(btn,opt,current.answer,current.explanation||'');$('#options').appendChild(btn);});$('#feedback').style.display='none';state.feedbackWaiting=false;}
    function selectOption(btn,opt,answer,explanation){if(state.feedbackWaiting) return;state.feedbackWaiting=true;const options=$$('#options .option');options.forEach(b=>b.disabled=true);const correctBtn=[...options].find(b=>b.textContent.replace(/[A-D]\s?/,'').trim()===answer.trim());const t=translations[state.lang];if(opt===answer){btn.classList.add('correct');correctTone();state.score++;state.points+=100;$('#score-points').textContent=String(state.points).padStart(4,'0');spawnPoints(btn,'+100');const msg=t.encouragementRight[Math.floor(Math.random()*t.encouragementRight.length)];const sub=t.subRight[Math.floor(Math.random()*t.subRight.length)];showFeedback(msg,sub,true,explanation);}else{btn.classList.add('wrong');wrongTone();if(correctBtn) correctBtn.classList.add('correct');const msg=t.encouragementWrong[Math.floor(Math.random()*t.encouragementWrong.length)];const sub=t.subWrong[Math.floor(Math.random()*t.subWrong.length)];showFeedback(msg,sub,false,explanation);}state.answered++;$('#score-answered').textContent=state.answered;const progress=state.answered/state.quiz.length;$('#progress-bar').style.transform=`scaleX(${progress})`;}
    function showFeedback(main,sub,positive,explanation){const banner=$('#feedback');$('#feedback-main').textContent=main;$('#feedback-sub').textContent=explanation||sub;banner.style.display='flex';banner.dataset.state=positive?'success':'error';}
    function spawnPoints(target,text){const floating=document.createElement('div');floating.className='points-float';floating.textContent=text;const rect=target.getBoundingClientRect();floating.style.left=`${rect.left + rect.width/2}px`;floating.style.top=`${rect.top - 10}px`;floating.style.position='fixed';document.body.appendChild(floating);setTimeout(()=>floating.remove(),700);} function nextQuestion(){state.index++;renderQuestion();}
    function showResults(){showModal(quizModal,false);showModal(resultModal,true);const total=state.quiz.length;const percent=Math.round((state.score/total)*100)||0;const t=translations[state.lang];let title,desc;if(percent===100){title=t.resultPerfect;desc=t.resultPerfectMsg;}else if(percent>=80){title=t.resultGreat;desc=t.resultGreatMsg;}else if(percent>=50){title=t.resultGood;desc=t.resultGoodMsg;}else{title=t.resultTry;desc=t.resultTryMsg;}$('#result-title').textContent=title;$('#result-score').textContent=`${percent}%`;$('#result-message').textContent=desc;$('#result-card').classList.add('show-confetti');setTimeout(()=>$('#result-card').classList.remove('show-confetti'),1800);speak(desc);saveHistory({score:state.score,total,percentage:percent,date:Date.now()});}
    async function startPipeline(){try{state.index=0;state.score=0;state.points=0;state.answered=0;state.quiz=[];showModal(questionModal,false);updateProcessingSteps();showModal(processingModal,true);setStepStatus(1,3);const aiResult=await generateQuiz();setStepStatus(2,3);const questions=(aiResult.questions||[]).slice(0,state.questionCount);state.quiz=questions.map(q=>({question:q.question,options:q.options,answer:q.answer?.trim?.()||'',explanation:q.explanation||''}));if(!state.quiz.length) throw new Error('API Error - No questions generated');setStepStatus(3,3);setTimeout(()=>{showModal(processingModal,false);showModal(quizModal,true);renderQuestion();},400);}catch(err){console.error('❌ API Error - Quiz generation failed',err);showModal(processingModal,false);toast(translations[state.lang].toastError,false);$('#error-text').textContent=err.message;$('#error-text').classList.remove('hidden');}}
    $('#gallery-btn').onclick=()=>$('input#gallery-input').click();$('#camera-btn').onclick=()=>$('input#camera-input').click();$('#gallery-input').onchange=(e)=>readFiles(e.target.files);$('#camera-input').onchange=(e)=>readFiles(e.target.files);
    $('#send-btn').onclick=()=>{if(!state.files.length){toast(translations[state.lang].toastError,false);return;}if(state.base64.length!==state.files.length){toast('Preparing files...',false);return;}showModal(questionModal,true);};
    $('#question-close').onclick=()=>showModal(questionModal,false);$('#quick-five').onclick=()=>{state.questionCount=5;$('#question-value').textContent='5';startPipeline();};$('#question-continue').onclick=()=>{state.questionCount=parseInt($('#question-range').value,10);startPipeline();};$('#question-range').oninput=e=>{state.questionCount=parseInt(e.target.value,10);$('#question-value').textContent=e.target.value;};
    $('#next-question').onclick=()=>{state.feedbackWaiting=false;nextQuestion();};$('#result-retry').onclick=()=>{showModal(resultModal,false);showModal(questionModal,true);};$('#result-home').onclick=()=>{showModal(resultModal,false);resetQuizState();};
    $('#api-btn').onclick=()=>{showModal(apiModal,true);$('#api-input').value=state.customKey;};$('#api-close').onclick=()=>showModal(apiModal,false);$('#api-save').onclick=()=>{state.customKey=$('#api-input').value.trim();localStorage.setItem('gloryGeminiKey',state.customKey);toast(translations[state.lang].toastSaved);showModal(apiModal,false);};$('#api-clear').onclick=()=>{state.customKey='';localStorage.removeItem('gloryGeminiKey');$('#api-input').value='';toast(translations[state.lang].toastCleared);};
    $('#history-btn').onclick=()=>{updateHistory();showModal(historyModal,true);};$('#history-close').onclick=()=>showModal(historyModal,false);$('#history-clear').onclick=()=>{state.history=[];localStorage.removeItem('gloryHistory');updateHistory();toast(translations[state.lang].toastCleared);};
    $('#result-modal').addEventListener('click',e=>{if(e.target.id==='result-modal') showModal(resultModal,false);});$('#quiz-modal').addEventListener('click',e=>{if(e.target.id==='quiz-modal') showModal(quizModal,false);});
    $$('.lang-btn').forEach(btn=>btn.onclick=()=>{state.lang=btn.dataset.lang;localStorage.setItem('gloryLang',state.lang);applyTranslations();updateProcessingSteps();updateHistory();});
    applyTranslations();updateProcessingSteps();renderPreviews();resetQuizState();
  </script>
</body>
</html>
